FROM python:3.7-slim

RUN apt install --yes --force-yes \
    libxml2-dev \
    postgresql-server-dev-all \
    && pip install --no-cache-dir --upgrade pip pipenv \
    && apt clean --yes --force-yes \
    && apt autoremove --yes --force-yes
RUN useradd jarr --create-home --shell /bin/bash --home-dir /jarr --user-group
WORKDIR /jarr
USER jarr
COPY ./Pipfil* /jarr/
RUN pipenv sync
COPY ./jarr/ /jarr/jarr
COPY ./migrations/ /jarr/migrations
COPY ./manager.py /jarr/manager.py
COPY ./*.py /jarr/

COPY example_conf/jarr.json /etc/jarr/jarr.json
VOLUME /etc/jarr/
