FROM python:3.7-slim

RUN apk add --no-cache --virtual .build-deps \
    g++ \
    python-dev \
    libxml2 \
    libxml2-dev && \
    gcc \
    python3-dev \
    musl-dev \
    postgresql-dev \
    && pip install --no-cache-dir --upgrade pip pipenv \
    && apk del --no-cache .build-deps
RUN useradd jarr --create-home --shell /bin/bash --home-dir /jarr --user-group
WORKDIR /jarr
USER jarr
COPY ./Pipfil* /jarr/
RUN pipenv sync
COPY ./jarr/ /jarr/jarr
COPY ./migrations/ /jarr/migrations
COPY ./manager.py /jarr/manager.py
COPY ./*.py /jarr/

COPY example_conf/jarr.json /etc/jarr/jarr.json
VOLUME /etc/jarr/
